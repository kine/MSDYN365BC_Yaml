# File: InstallAlApps.yml

parameters:
  CertPath: ''

steps:
- powershell: |
   Import-Module .\Scripts\NVRAppDevOps\NVRAppDevOps.psm1 -DisableNameChecking
   Import-Module .\Scripts\navcontainerhelper\NavContainerHelper.psm1 -DisableNameChecking
   $Config = Read-ALConfiguration -Path .\ 
   $Config | UnPublish-ALAppTree -OrderedApps (Get-ALAppOrder)
   if ($env:CertPath) {
   $Config | Publish-ALAppTree -OrderedApps (Get-ALAppOrder) -PackagesPath $env:Build_ArtifactStagingDirectory
   } else {
   $Config | Publish-ALAppTree -OrderedApps (Get-ALAppOrder) -PackagesPath $env:Build_ArtifactStagingDirectory -SkipVerification 'true'
   } 

  displayName: 'Install AL Apps'
  env:
    CertPath: ${{ parameters.CertPath }}
